package com.linn.blog.service.admin;

import java.io.BufferedInputStream;
import java.io.BufferedReader;
import java.io.ByteArrayInputStream;
import java.io.InputStreamReader;
import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;

import com.linn.blog.common.Const;
import com.linn.blog.entity.extension.Article;
import com.linn.blog.utils.JDBCUtils;

/**
 * 文章service
 * @author Administrator
 *
 */
public class ArticleServiceImpl {

	public int addArticle(Article article){
		Connection conn =null;
		PreparedStatement ps=null;
		String sql = "INSERT INTO t_article (category_id,title,content,description,description_pic,last_time,is_draft) VALUES (?,?,?,?,?,?,?);";  
		
		Connection conn = JDBCUtils.getMysqlConn();
		ps = conn.prepareStatement(sql);
		
		article.setLastTime(new Date(System.currentTimeMillis()));
		
		ps.setObject(1, article.getCategoryId());
		ps.setObject(2, article.getTitle());
		ps.setClob(3, new BufferedReader(new InputStreamReader(
				new BufferedInputStream(
                		new ByteArrayInputStream(article.getContent().getBytes("utf-8"))		
				),"utf-8")));
		ps.setObject(4, article.getIntro());
		ps.setObject(5, article.getIntroPicName());
		ps.setObject(6, article.getLastTime());
		ps.setObject(7, Const.NO);

		count = ps.executeUpdate();
		JDBCUtils.close(ps, conn);
		return count;
	}
}
